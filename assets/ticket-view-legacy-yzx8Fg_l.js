System.register(["./chakra-legacy-S6iHddlO.js","./react-legacy-KN5lAqTZ.js","./index-legacy-q40kyNlY.js","./pantone-input-legacy-i42OSSU8.js","./line-detail-card-legacy-rY4HdtUo.js","./pantone-checker-legacy-mwYcl9Vg.js"],(function(e,n){"use strict";var t,s,i,r,a,o,l,c,d,u,h,j,x,g,p,m,y,f,C,v,b,w,k,S,L,E,O,R,P,I,z,N,D,U,A,F,M,J,T,$,q,B,G,K,H,V,Y,_,W,Z,Q,X,ee,ne,te,se,ie,re,ae,oe,le,ce,de,ue,he,je,xe,ge,pe,me,ye,fe,Ce,ve;return{setters:[e=>{t=e.H,s=e.ap,i=e.a,r=e.ar,a=e.K,o=e.a0,l=e.a1,c=e.as,d=e.at,u=e.a2,h=e.aq,j=e.a3,x=e.au,g=e.a4,p=e.av,m=e.aw,y=e.Y,f=e.ax,C=e._,v=e.$,b=e.F},e=>{w=e.l,k=e.r,S=e.o},e=>{L=e.b,E=e.u,O=e.L,R=e.i,P=e.j,I=e.k,z=e.l,N=e.m,D=e.n,U=e.o,A=e.p,F=e.q,M=e.t,J=e.v,T=e.w,$=e.x,q=e.y,B=e.z,G=e.A,K=e.B,H=e.C,V=e.D,Y=e.F,_=e.G,W=e.H,Z=e.I,Q=e.J,X=e.K,ee=e.N,ne=e.O,te=e.P,se=e.Q,ie=e.S,re=e.T,ae=e.r,oe=e.U,le=e.V,ce=e.g,de=e.h,ue=e.E},e=>{he=e.u,je=e.R,xe=e.M,ge=e.a,pe=e.b,me=e.c,ye=e.d},e=>{fe=e.M,Ce=e.L},e=>{ve=e.P}],execute:function(){function n(){const{t:e,i18n:n}=w(),r=he(),a=L(),{countryList:o}=E((e=>e.app)),{country:l,newCountry:c,countryName:d,newCountryLang:u}=E((e=>e.ticket)),h={...o.map((e=>[e.id,r(e.name)])).sort(((e,t)=>e[1].localeCompare(t[1],n.languages[0]))).reduce(((e,n)=>"UN"===n[0]?e:{...e,[n[0]]:n[1]}),{"":e("Please select...")}),new:e("Add a country/region...")},j=Object.entries(O).reduce(((e,n)=>({...e,[n[0]]:r(n[1])})),{}),x=[{type:"select",label:e("Country/Region"),value:l,options:h,disabledOptions:[""],onChange:e=>a(R(e))},{type:"input",label:e("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:c,validator:e=>""!==e&&!!e.match(/^[A-Z]{2}$|^GB[A-Z]{3}$/),onChange:e=>a(P(e)),hidden:"new"!==l},{type:"select",label:e("Official language"),value:u,options:j,onChange:e=>a(I(e||void 0)),hidden:"new"!==l}];return t.jsxs(z,{children:[t.jsx(N,{children:t.jsx(s,{as:"h5",size:"sm",children:e("Country/Region")})}),t.jsxs(i.div,{px:1,children:[t.jsx(je,{fields:x}),"new"===l&&t.jsx(fe,{entries:d,onUpdate:(e,n)=>a(D({lang:e,name:n})),onLangSwitch:(e,n)=>a(U({prevLang:e,nextLang:n})),onRemove:e=>a(A(e))})]})]})}function be(){const{t:e,i18n:n}=w(),r=L(),a=he(),{cityList:o}=E((e=>e.app)),{country:l,city:c,newCity:d,cityName:u}=E((e=>e.ticket)),h={...o.filter((e=>e.country===l)).map((e=>[e.id,a(e.name)])).sort(((e,t)=>e[1].localeCompare(t[1],n.languages[0]))).reduce(((e,n)=>({...e,[n[0]]:n[1]})),{"":e("Please select...")}),new:e("Add a city")+"..."},j=[{type:"select",label:e("City"),value:c,options:h,disabledOptions:[""],onChange:e=>(async e=>{if("new"===e)return void r($("new"));const n=await q(e,o);r(n?B(n):G())})(e)},{type:"input",label:e("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:d,onChange:e=>r(F(e)),validator:e=>""!==e&&!e.match(/[^a-z]/),hidden:"new"!==c}];return t.jsxs(z,{children:[t.jsx(N,{children:t.jsx(s,{as:"h5",size:"sm",children:e("City")})}),t.jsxs(i.div,{px:1,children:[t.jsx(je,{fields:j}),"new"===c&&t.jsx(fe,{entries:u,onUpdate:(e,n)=>r(M({lang:e,name:n})),onLangSwitch:(e,n)=>r(J({prevLang:e,nextLang:n})),onRemove:e=>r(T(e))})]})]})}function we(){const{t:e}=w(),n=L(),i=E((e=>e.ticket.lines));return t.jsxs(z,{children:[t.jsxs(N,{children:[t.jsx(s,{as:"h5",size:"sm",mr:"auto",children:e("Lines")}),t.jsx(ve,{})]}),t.jsxs(r,{spacing:1,px:1,children:[Object.entries(i).map((([e,s])=>t.jsx(Ce,{lineDetail:s,editable:!0,onUpdate:t=>n(K({entryId:e,updates:t})),onMoveUp:()=>n(H(e)),onMoveDown:()=>n(V(e)),onCopy:()=>n(Y(e)),onRemove:()=>n(_(e)),onNameUpdate:(t,s)=>n(W({entryId:e,lang:t,name:s})),onLangSwitch:(t,s)=>n(Z({entryId:e,prevLang:t,nextLang:s})),onNameRemove:t=>n(Q({entryId:e,lang:t}))},e))),t.jsx(a,{size:"xs",variant:"ghost",leftIcon:t.jsx(xe,{}),ml:"auto !important",onClick:()=>n(X()),children:e("Add a line")})]})]})}function ke(e){const{countryErrors:n,cityErrors:i,lineErrors:r,onIgnore:j,onClose:x}=e,{t:g}=w(),p=he();return t.jsxs(t.Fragment,{children:[t.jsxs(o,{children:[t.jsx(l,{children:g("Your inputs contain the following errors. Please consider fixing it before submitting.")}),n.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s,{as:"h5",size:"sm",my:2,children:g("Country/Region")}),t.jsx(c,{"aria-label":"List of country errors",children:n.map(((e,n)=>t.jsx(d,{children:p(ee[e])},n)))})]}),i.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s,{as:"h5",size:"sm",my:2,children:g("City")}),t.jsx(c,{"aria-label":"List of city errors",children:i.map(((e,n)=>t.jsx(d,{children:p(ee[e])},n)))})]}),Object.values(r).flat().length>0&&t.jsxs(t.Fragment,{children:[t.jsx(s,{as:"h5",size:"sm",my:2,children:g("Lines")}),t.jsx(c,{"aria-label":"List of line errors",children:Object.entries(r).map((([e,n])=>t.jsxs(d,{children:[e,t.jsx(c,{children:n.map(((e,n)=>t.jsx(d,{children:p(ee[e])},n)))})]},e)))})]})]}),t.jsx(u,{children:t.jsxs(h,{children:[t.jsx(a,{onClick:j,children:g("Submit anyway")}),t.jsx(a,{colorScheme:"primary",onClick:x,children:g("Go back")})]})})]})}e("default",(function(){const{t:e}=w(),s=L(),i=S(),{isDataLoading:r}=E((e=>e.app)),[o,l]=k.useState(),[c,d]=k.useState(!1),[u,j]=k.useState(!1);return k.useEffect((()=>{const e=ae.storage.get(oe);if(e)try{const n=JSON.parse(e);Object.keys(n.lines).length>0&&Object.values(n.lines)[0].id&&(l(n),d(!0))}catch(n){console.error("TicketView:: unable to restore draft ticket",e)}}),[]),t.jsxs(ce,{alignSelf:"center",sx:{width:{base:"100%",md:520}},children:[r&&t.jsx(de,{isIndeterminate:!0}),t.jsxs(b,{direction:"column",flex:1,overflowY:"auto",bg:"inherit",children:[t.jsx(n,{}),t.jsx(be,{}),t.jsx(we,{})]}),t.jsxs(b,{my:2,children:[t.jsx(a,{size:"sm",onClick:()=>{ae.isStandaloneWindow()?i("/"):ae.openApp("rmg-palette")},children:e("Go back")}),t.jsxs(h,{ml:"auto",children:[t.jsx(a,{size:"sm",variant:"outline",onClick:()=>{s(le()),ae.storage.remove(oe),ae.event(ue.RESET_TICKET,{})},children:e("Reset")}),t.jsx(a,{size:"sm",colorScheme:"primary",onClick:()=>j(!0),children:e("Submit")})]})]}),t.jsx(Re,{isOpen:c,onClose:()=>d(!1),incomingState:o}),t.jsx(Oe,{isOpen:u,onClose:()=>j(!1)})]})}));const Se=e=>{var n;return!(null===(n=e.match(/^https?:\/\//))||void 0===n||!n[0])};function Le(e){const{dataSource:n,onDataSourceChange:s,refLink:i,onRefLinkChange:r,justification:c,onJustificationChange:d,onPrev:h,onNext:j}=e,{t:x}=w(),g=he(),p=Object.fromEntries([["",x("Please select...")],...Object.entries(ne).map((([e,n])=>[e,g(n)]))]),m=[{type:"select",label:x("Data source"),options:p,disabledOptions:[""],value:n,onChange:e=>s(e)},{type:"input",value:i,label:x("Reference link"),placeholder:x("Enter a valid URL, e.g.")+" https://en.wikipedia.org",onChange:r,validator:Se},{type:"textarea",value:c,label:x("Justification"),placeholder:x("Briefly describe your changes and provide justification"),onChange:d}],y=!(n&&i&&c&&Se(i));return t.jsxs(t.Fragment,{children:[t.jsxs(o,{children:[t.jsx(l,{children:x("Please provide suitable source and justification.")}),t.jsx(je,{fields:m,minW:"full"})]}),t.jsxs(u,{children:[h&&t.jsx(a,{variant:"ghost",onClick:h,mr:"auto",leftIcon:t.jsx(ge,{}),children:x("Previous")}),t.jsx(a,{colorScheme:"primary",onClick:j,rightIcon:t.jsx(pe,{}),isDisabled:y,children:x("Next")})]})]})}function Ee(e){var n,s;const{countryEntry:i,cityEntry:r,paletteList:c,dataSource:h,refLink:m,justification:y,onPrev:f}=e,{t:C}=w(),v=he(),b=j("primary.500","primary.300"),S=k.useRef(null),L=[`**Data source:** ${h?v(ne[h]):"(REPLACE ME)"}`,`**Reference link:** ${m||"(REPLACE ME)"}`,`**Justification:** ${y||"(REPLACE ME)"}`,te,se("country",i),se("city",r),se("lines",c)].join("\n\n"),E=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+(null==r||null===(n=r.name)||void 0===n?void 0:n.en),body:L}),O=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+(null==r||null===(s=r.name)||void 0===s?void 0:s.en)});return t.jsxs(t.Fragment,{children:[t.jsxs(o,{children:[t.jsx(l,{children:C("If the button below doesn't work for you, please follow the instructions below:")}),t.jsxs(x,{children:[t.jsxs(d,{children:[C("Open")," ",t.jsxs(g,{color:b,href:"https://github.com/railmapgen/rmg-palette/issues/new?"+O.toString(),isExternal:!0,children:["Issue: New Palettes Request ",t.jsx(p,{as:me})]})]}),t.jsxs(d,{children:[C("Paste following text to the issue body")," ",t.jsx(a,{size:"xs",leftIcon:t.jsx(ye,{}),onClick:async()=>{null!=S&&S.current&&(S.current.select(),await navigator.clipboard.writeText(L))},children:C("Copy")}),t.jsx(ie,{ref:S,isReadOnly:!0,defaultValue:L,onClick:({target:e})=>e.select()})]})]})]}),t.jsxs(u,{children:[t.jsx(a,{variant:"ghost",onClick:f,mr:"auto",leftIcon:t.jsx(ge,{}),children:C("Previous")}),t.jsx(a,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+E.toString(),"_blank"),children:C("1-click open issue")})]})]})}function Oe(e){const{isOpen:n,onClose:s}=e,{t:i}=w(),[r,a]=k.useState([]),[o,l]=k.useState([]),[c,d]=k.useState({}),[u,h]=k.useState(""),[j,x]=k.useState(""),[g,p]=k.useState(""),[b,S]=k.useState(!1),[L,O]=k.useState(!1),{countryList:R}=E((e=>e.app)),P=E((e=>e.ticket)),I=re.getCountryEntry(P),z=re.getCityEntry(P),N=re.getPalettes(P);k.useEffect((()=>{n?(a(re.getCountryErrors(P)),l(re.getCityErrors(P,R)),d(re.getLineErrors(P,R))):(S(!1),h(""),x(""),p(""),O(!1))}),[n]);const D=r.length>0||o.length>0||Object.values(c).flat().length>0,U=D&&!b,A=!U&&!L;return t.jsxs(m,{blockScrollOnMount:!1,isOpen:n,onClose:s,scrollBehavior:"inside",children:[t.jsx(y,{}),t.jsxs(f,{children:[t.jsx(C,{children:i("Submit palettes")}),t.jsx(v,{onClick:()=>{U||A||ae.storage.remove(oe),s()}}),U&&t.jsx(ke,{countryErrors:r,cityErrors:o,lineErrors:c,onIgnore:()=>S(!0),onClose:s}),A&&t.jsx(Le,{dataSource:u,onDataSourceChange:h,refLink:j,onRefLinkChange:x,justification:g,onJustificationChange:p,onPrev:D?()=>S(!1):void 0,onNext:()=>O(!0)}),!U&&!A&&t.jsx(Ee,{countryEntry:I,cityEntry:z,paletteList:N,dataSource:u,refLink:j,justification:g,onPrev:()=>O(!1)})]})]})}function Re(e){const{isOpen:n,onClose:s,incomingState:i}=e,{t:r}=w(),l=L();return t.jsxs(m,{isOpen:n,onClose:s,children:[t.jsx(y,{}),t.jsxs(f,{children:[t.jsx(C,{children:r("Unsaved draft")}),t.jsx(v,{}),t.jsx(o,{children:r("Do you want to continue with your last unsaved ticket?")}),t.jsx(u,{children:t.jsxs(h,{children:[t.jsx(a,{onClick:()=>{ae.storage.remove(oe),s()},children:r("Discard")}),t.jsx(a,{colorScheme:"primary",onClick:()=>{i&&l(le(i)),s()},children:r("Continue")})]})})]})]})}}}}));
