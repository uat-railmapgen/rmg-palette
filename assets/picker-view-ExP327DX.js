import{H as t,F as X,ap as q,K as I,W as K,g as Z,ac as J,D as Q,aq as T}from"./chakra-oz4Mm5GU.js";import{u as A,Y as H,M as v,a as O,W as _,l as ee,m as te,b as oe,r as P,E as S,g as ne,h as se,Z as ae,_ as re}from"./index-DWcuudcV.js";import{l as V,r as g,p as le}from"./react-CVMQYbqF.js";import{u as M,P as ce,R as k,i as ie}from"./pantone-input-YOiCqH3F.js";import{u as ue}from"./use-palette-SvZfM3Mn.js";import{P as de}from"./pantone-checker-4jfFm2vi.js";const pe=u=>{const o=u.toUpperCase().split("");return o.length===2?o.map(r=>((r.codePointAt(0)||0)+127397).toString(16).toUpperCase()):o.length===5?["1F3F4",...o.map(r=>((r.codePointAt(0)||0)+917536).toString(16).toUpperCase()),"E007F"]:[]},me=u=>{const o=pe(u);return String.fromCodePoint(...o.map(r=>parseInt(r,16)))};function ge(u){const{defaultValueId:o,onChange:r}=u,{i18n:d}=V(),m=M(),{cityList:f}=A(e=>e.app),a=o?f.find(e=>e.id===o):void 0,x=e=>{const l=e.country==="TW"&&["zh-Hans","zh-CN"].includes(d.languages[0]);return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"flag-emoji",children:l?"🏴":me(e.country)}),t.jsx("span",{children:m(e.name)})]})},j=(e,l)=>{const i=e.toLocaleLowerCase();return l.id.toLocaleLowerCase().includes(i)||Object.values(l.name).some(s=>s.toLowerCase().includes(i))},c=f.slice().map(e=>({...e,value:m(e.name)})).sort((e,l)=>e.id==="other"?1:l.id==="other"?-1:e.value.localeCompare(l.value,d.languages[0]));return t.jsx(H,{data:c,displayHandler:x,filter:j,value:a&&m(a.name),onChange:e=>r==null?void 0:r(e.id)})}function Ce(u){const{city:o,defaultValueId:r,onChange:d}=u,m=M(),f=ue(o),a=r?f.find(e=>e.id===r):void 0,x=e=>t.jsx(O,{name:m(e.name),fg:e.fg||v.white,bg:e.colour}),j=(e,l)=>{const i=e.toLocaleLowerCase();return l.id.toLocaleLowerCase().includes(i)||Object.values(l.name).some(s=>s.toLocaleLowerCase().includes(i))},c=f.map(e=>({...e,value:m(e.name)}));return t.jsx(H,{data:c,displayHandler:x,filter:j,value:a&&m(a.name),onChange:e=>d==null?void 0:d(e.id,e.colour,e.fg||v.white,e.pantone)})}const D=u=>!!u.match(/^#[0-9a-fA-F]{6}$/),he={flexDirection:"column",flex:1,mx:2,overflowX:"hidden",overflowY:"auto","& .chakra-badge":{fontSize:"1em",width:"fit-content",alignSelf:"center",m:1},"& > section:first-of-type":{p:1},"& > section:last-of-type":{w:"100%","& > div:last-of-type":{px:2},"& .rmg-section__header button":{ml:"auto"}}};function fe(u){const{defaultTheme:o,sessionId:r,onSubmit:d,onClose:m,onClearHistory:f}=u,{t:a}=V(),{recentlyUsed:x,pantoneReady:j}=A(n=>n.app),[c,e]=g.useState(o==null?void 0:o[0]),[l,i]=g.useState(o==null?void 0:o[1]),[s,p]=g.useState((o==null?void 0:o[2])||"#AAAAAA"),[C,h]=g.useState((o==null?void 0:o[3])||v.white),[N,b]=g.useState(""),[y,R]=g.useState("color"),L=()=>{b(""),R(n=>n==="pantone"?"color":n)};g.useEffect(()=>{r&&o&&(e(o[0]),i(o[1]),p(o[2]),h(o[3]),L())},[r,o==null?void 0:o.toString()]);const W=[{label:a("Select"),value:"color"},{label:a("RGB"),value:"text"},{label:a("Pantone®"),value:"pantone",disabled:!j}],B=[{label:a("Black"),value:v.black},{label:a("White"),value:v.white}],z=[{type:"custom",label:a("City"),component:t.jsx(ge,{defaultValueId:c,onChange:n=>{e(n),i(void 0),p("#AAAAAA"),h(v.white)}})},{type:"custom",label:a("Line"),component:t.jsx(Ce,{city:c,defaultValueId:l,onChange:(n,E,G,F)=>{i(n),p(E),h(G),F&&b(F)}})}],U=[{type:"custom",label:a("Input mode"),component:t.jsx(_,{selections:W,defaultValue:y,onChange:n=>R(n)})},{type:"custom",label:a("Pantone® code"),component:t.jsx(ce,{value:N,onChange:(n,E)=>{e("other"),i("other"),p(E),b(n)}}),hidden:y!=="pantone"},{type:"input",label:a("Background colour"),variant:y==="pantone"?"color":y,value:s,placeholder:"#F3D03E",validator:D,onChange:n=>{e("other"),i("other"),p(n),L()},isDisabled:y==="pantone"},{type:"custom",label:a("Foreground colour"),component:t.jsx(_,{selections:B,defaultValue:C,onChange:n=>{e("other"),i("other"),h(n)}})}],w=c&&l&&s&&C&&D(s),$=()=>{if(w){const n="".concat(c," - ").concat(l);d==null||d([c,l,s,C],n)}},Y=n=>{e(n[0]),i(n[1]),p(n[2]),h(n[3]),L()};return t.jsxs(t.Fragment,{children:[t.jsxs(X,{sx:he,children:[t.jsx(O,{name:a("Example"),fg:C,bg:s}),t.jsxs(ee,{children:[t.jsx(de,{hidden:!0}),t.jsx(k,{fields:z}),t.jsx(k,{fields:U})]}),t.jsxs("section",{children:[t.jsxs(te,{children:[t.jsx(q,{as:"h5",size:"xs",children:a("Recently used")}),t.jsx(I,{variant:"ghost",size:"xs",onClick:f,children:a("Clear")})]}),t.jsx(K,{children:x.map(({theme:n,displayName:E})=>t.jsx(Z,{children:t.jsx(J,{size:"xs","aria-label":a("Apply"),title:E,mt:"0.45px",color:n[3],bg:n[2],icon:t.jsx(ie,{}),onClick:()=>Y(n)})},n.join("-")))})]})]}),t.jsx(Q,{}),t.jsxs(T,{p:2,justifyContent:"flex-end",children:[t.jsx(I,{size:"sm",onClick:m,children:a("Cancel")}),t.jsx(I,{size:"sm",colorScheme:"primary",onClick:$,isDisabled:!w,children:a("Confirm")})]})]})}const xe="rmg-palette-bridge--";function be(){const[u]=le(),o=u.get("parentId"),r=u.get("parentComponent"),d=oe(),{isDataLoading:m}=A(s=>s.app),[f,a]=g.useState(),[x,j]=g.useState(),c=g.useRef();g.useEffect(()=>{const s=new BroadcastChannel(xe+o);return c.current=s,P.event(S.APP_CLIP_VIEW_OPENED,{parentComponent:r}),s.onmessage=p=>{const{event:C,data:h}=p.data;console.log("[".concat(s.name,"] Received event from parent component:"),C),C==="OPEN"&&(a(crypto.randomUUID()),j(h))},console.log("[".concat(s.name,"] App clip connection established, parentComponent=").concat(r)),s.postMessage({event:"LOADED"}),()=>{s.close()}},[]);const e=(s,p)=>{var C,h;console.log("[".concat((C=c.current)==null?void 0:C.name,"] Emitting SELECT event, theme:"),s),(h=c.current)==null||h.postMessage({event:"SELECT",data:s}),d(ae({theme:s,displayName:p})),P.event(S.APP_CLIP_VIEW_SELECT,{parentComponent:r,theme:s})},l=()=>{var s,p;console.log("[".concat((s=c.current)==null?void 0:s.name,"] Emitting CLOSE event")),(p=c.current)==null||p.postMessage({event:"CLOSE"}),P.event(S.APP_CLIP_VIEW_CLOSED,{parentComponent:r})},i=()=>{d(re()),P.event(S.CLEAR_HISTORY,{})};return t.jsxs(ne,{children:[m&&t.jsx(se,{isIndeterminate:!0}),t.jsx(fe,{defaultTheme:x,sessionId:f,onSubmit:e,onClose:l,onClearHistory:i})]})}export{be as default};
